#include "commytat.h"
#include "MDR32F9Qx_port.h"             // Keil::Drivers:PORT

//#include "per.h"
extern uint32_t ygol;

const static uint16_t TablCom[]=
{0x000,0xFFF,0x000,0xFC7,0x000,0x03A,0x000,0x032,
 0x000,0x02E,0x000,0x02A,0x000,0x027,0x000,0x025,
 0x000,0x022,0x000,0x020,0x000,0x01E,0x000,0x01D,
 0x000,0x01B,0x000,0x01A,0x001,0x019,0x001,0x018,
 0x001,0x017,0x001,0x016,0x001,0x014,0x001,0x013,
 0x001,0x013,0x001,0x012,0x001,0x011,0x001,0x010,
 0x002,0x010,0x002,0x00F,0x002,0x00E,0x002,0x00E,
 0x002,0x00D,0x002,0x00C,0x002,0x00C,0x003,0x00C,
 0x003,0x00B,0x003,0x00B,0x003,0x00A,0x004,0x00A,
 0x004,0x00A,0x004,0x009,0x004,0x008,0x004,0x008,
 0x005,0x008,0x005,0x007,0x005,0x007,0x006,0x007,
 0x006,0x007,0x006,0x006,0x007,0x006,0x007,0x006,
 0x007,0x005,0x007,0x005,0x008,0x005,0x008,0x004,
 0x008,0x004,0x009,0x004,0x00A,0x004,0x00A,0x004,
 0x00A,0x003,0x00B,0x003,0x00B,0x003,0x00C,0x003,
 0x00C,0x002,0x00C,0x002,0x00D,0x002,0x00E,0x002,
 0x00E,0x002,0x00F,0x002,0x010,0x002,0x010,0x001,
 0x011,0x001,0x012,0x001,0x013,0x001,0x013,0x001,
 0x014,0x001,0x016,0x001,0x017,0x001,0x018,0x001,
 0x019,0x001,0x01A,0x000,0x01B,0x000,0x01D,0x000,
 0x01E,0x000,0x020,0x000,0x022,0x000,0x025,0x000,
 0x027,0x000,0x02A,0x000,0x02E,0x000,0x032,0x000,
 0x03A,0x000,0xFC7,0x000,0xFFE,0x000,0xFFE,0x000};

 
void CommytatInit(void) {
	MDR_PORTB->FUNC &= 	
				~((0x03 << (2 * 8)) | (0x03 << (2 * 9))  |
					 (0x03 << (2 * 10)) | (0x03 << (2 * 11)) |
					 (0x03 << (2 * 12)) | (0x03 << (2 * 13)) |
					 (0x03 << (2 * 14)) | (0x03 << (2 * 15)));
	MDR_PORTB->OE &= ~((1 << 8) | (1 << 9) | (1 << 10) | (1 << 11) | 
								 (1 << 12) | (1 << 13) | (1 << 14) | (1 << 15));

	MDR_PORTB->ANALOG |= ((1 << 8) | (1 << 9) | (1 << 10) | (1 << 11) |
										(1 << 12) | (1 << 13) | (1 << 14) | (1 << 15));

	MDR_PORTB->PWR |= ~((0x03 << (2 * 8)) | (0x03 << (2 * 9))  |
									(0x03 << (2 * 10)) |(0x03 << (2 * 11)) |
									(0x03 << (2 * 12)) |(0x03 << (2 * 13)) |
									(0x03 << (2 * 14)) |(0x03 << (2 * 15)));
	}

void YprCommyt(void)
	
{	uint16_t Asin;
	uint16_t Acos;
	
	if(ygol<90)
	{
	
	Asin = TablCom[ygol*2];
	Acos = TablCom[ygol*2+1];
	
	MDR_PORTD->SETTX = 0xFFFF;
	MDR_PORTE->SETTX = 0xFFFF;
		
	MDR_PORTD->CLRTX = Asin;
	MDR_PORTE->CLRTX = Acos;
		
		
	}
	/////////////////////////////////////////////////////////////////////////////
	
	if (90<ygol && ygol<180)
	{
	Asin = TablCom[(ygol-90)*2];
	Acos = TablCom[(ygol-90)*2+1];
	
	MDR_PORTD->SETTX = 0xFFFF;
	MDR_PORTE->SETTX = 0xFFFF;
	
		PORT_ResetBits(MDR_PORTD, PORT_Pin_12);
	MDR_PORTD->CLRTX = Asin;
	MDR_PORTE->CLRTX = Acos;
		

	}
		///////////////////////////////////////////////////////////////////////////
	
	if (180<ygol && ygol<270)
	
	{
	Asin = TablCom[(ygol-180)*2];
	Acos = TablCom[(ygol-180)*2+1];
	
	MDR_PORTD->SETTX = 0xFFFF;
	MDR_PORTE->SETTX = 0xFFFF;
	
		PORT_ResetBits(MDR_PORTD, PORT_Pin_12);
		PORT_ResetBits(MDR_PORTD, PORT_Pin_13);
	MDR_PORTD->CLRTX = Asin;
	MDR_PORTE->CLRTX = Acos;

	}
	/////////////////////////////////////////////////////////////////////////////
	
	if (270<ygol && ygol<360)
	
	{
	Asin = TablCom[(ygol-270)*2];
	Acos = TablCom[(ygol-270)*2+1];
	
	MDR_PORTD->SETTX = 0xFFFF;
	MDR_PORTE->SETTX = 0xFFFF;
	
		PORT_ResetBits(MDR_PORTD, PORT_Pin_13);
	MDR_PORTD->CLRTX = Asin;
	MDR_PORTE->CLRTX = Acos;
		

	}
	
}

	